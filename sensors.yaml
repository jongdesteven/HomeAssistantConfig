
- platform: fritzbox_netmonitor
  host: 10.1.1.2
  name: router_netmonitor

- platform: time_date
  display_options:
    - 'time'

- platform: mqtt
  state_topic: "raspi/temp"
  name: "Raspi Temperature"
  unit_of_measurement: "°C"
  icon: 'mdi:oil-temperature'
  value_template: '{{ value_json.temperature }}'

- platform: mqtt
  state_topic: "home/doorbell/ringer/time"
  name: "Doorbell Ring Time"
  unit_of_measurement: "ms"
- platform: mqtt
  state_topic: "home/bbq/update"
  value_template: "{{ value_json.p2 }}"
  name: "BBQ Sensor 2"
  availability_topic: "home/bbq/status"
  unit_of_measurement: "°C"
  icon: mdi:thermometer

- platform: template
  sensors:
    energieverbruik_totaal:
      entity_id: sensor.energieverbruik_totaal_hoog, sensor.energieverbruik_totaal_laag
      value_template: >
        {{ (states('sensor.energieverbruik_totaal_hoog') | float + states('sensor.energieverbruik_totaal_laag') | float) | round(2) }}
      unit_of_measurement: 'kWh'
- platform: template
  sensors:
    energieverbruik_per_uur:
      entity_id: sensor.energieverbruik_totaal
      value_template: >
        {% if states('sensor.energieverbruik_totaal') != 'unknown' %}  
          {{ (states('sensor.energieverbruik_totaal') | float - states('input_number.power_usage_previous_hour') | float) | round(2) }}
        {% else %}
          0
        {% endif %}
      unit_of_measurement: 'kWh'
- platform: template
  sensors:
    gasverbruik_per_uur:
      entity_id: sensor.gasverbruik_totaal
      value_template: >
        {% if states('sensor.gasverbruik_totaal') != 'unknown' %}  
          {{ (states('sensor.gasverbruik_totaal') | float - states('input_number.gas_usage_previous_hour') | float) | round(2) }}
        {% else %}
          0
        {% endif %}
      unit_of_measurement: 'm3'
- platform: template
  sensors:
    energieverbruik_per_dag:
      entity_id: sensor.energieverbruik_totaal
      value_template: >
        {% if states('sensor.energieverbruik_totaal') != 'unknown' %}  
          {{ (states('sensor.energieverbruik_totaal') | float - states('input_number.power_usage_previous_day') | float) | round(2) }}
        {% else %}
          0
        {% endif %}
      unit_of_measurement: 'kWh'
- platform: template
  sensors:
    gasverbruik_per_dag:
      entity_id: sensor.gasverbruik_totaal
      value_template: >
        {% if states('sensor.gasverbruik_totaal') != 'unknown' %}  
          {{ (states('sensor.gasverbruik_totaal') | float - states('input_number.gas_usage_previous_day') | float) | round(2) }}
        {% else %}
          0
        {% endif %}
      unit_of_measurement: 'm3'

- platform: template
  sensors:
    internet_transmission_up:
      value_template: >-
        {% if state_attr('sensor.router_netmonitor', 'transmission_rate_up') > 0 %}
          {{ (state_attr('sensor.router_netmonitor', 'transmission_rate_up') /1000 ) | round(0)  }}
        {% else %}
          0
        {% endif %}
      unit_of_measurement: "kB/s"
    internet_transmission_down:
      #value_template: "{{ (state_attr('sensor.router_netmonitor', 'transmission_rate_down') /1000) | round(0) }}"
      value_template: >-
        {% if state_attr('sensor.router_netmonitor', 'transmission_rate_down') > 0 %}
          {{ (state_attr('sensor.router_netmonitor', 'transmission_rate_down') /1000 ) | round(0)  }}
        {% else %}
          0
        {% endif %}
      unit_of_measurement: "kB/s"
    internet_data_sent:
      value_template: >-
        {% if state_attr('sensor.router_netmonitor', 'bytes_sent') > 0 %}
          {{ (state_attr('sensor.router_netmonitor', 'bytes_sent') /1000000000 ) | round(2)  }}
        {% else %}
          0
        {% endif %}
      unit_of_measurement: "GB"
    internet_data_received:
      value_template: >-
        {% if state_attr('sensor.router_netmonitor', 'bytes_received') > 0 %}
          {{ (state_attr('sensor.router_netmonitor', 'bytes_received') /1000000000 ) | round(2)  }}
        {% else %}
          0
        {% endif %}
      unit_of_measurement: "GB"


- platform: mqtt
  state_topic: "home/smartmeter/electricity_tariff"
  name: "Energie Tarief"
  icon: 'mdi:theme-light-dark'
- platform: mqtt
  state_topic: "home/smartmeter/power_delivered"
  name: "Energieverbruik Actueel"
  value_template: "{{ (float(value) * 1000) | round(0) }}"
  icon: 'mdi:power-plug'
  unit_of_measurement: "W"
- platform: mqtt
  state_topic: "home/smartmeter/water_delivered"
  name: "Gasverbruik Totaal"
  value_template: "{{ float(value) }}"
  icon: 'mdi:fire'
  unit_of_measurement: "m3"
- platform: mqtt
  state_topic: "home/smartmeter/energy_delivered_tariff1"
  name: "Energieverbruik Totaal Laag"
  value_template: "{{ float(value) }}"
  icon: 'mdi:power-plug'
  unit_of_measurement: "kWh"
- platform: mqtt
  state_topic: "home/smartmeter/energy_delivered_tariff2"
  name: "Energieverbruik Totaal Hoog"
  value_template: "{{ float(value) }}"
  icon: 'mdi:power-plug'
  unit_of_measurement: "kWh"

- platform: mqtt
  state_topic: "home/smartmeter/power_delivered_l1"
  name: "Energieverbruik Actueel L1"
  value_template: "{{ (float(value) * 1000) | int }}"
  icon: 'mdi:power-plug'
  unit_of_measurement: "W"
- platform: mqtt
  state_topic: "home/smartmeter/power_delivered_l2"
  name: "Energieverbruik Actueel L2"
  value_template: "{{ (float(value) * 1000) | int }}"
  icon: 'mdi:power-plug'
  unit_of_measurement: "W"
- platform: mqtt
  state_topic: "home/smartmeter/power_delivered_l3"
  name: "Energieverbruik Actueel L3"
  value_template: "{{ (float(value) * 1000) | int }}"
  icon: 'mdi:power-plug'
  unit_of_measurement: "W"

- platform: mqtt
  state_topic: "home/smartmeter/voltage_l1"
  name: "Spanning L1"
  icon: 'mdi:power-plug'
  unit_of_measurement: "V"
- platform: mqtt
  state_topic: "home/smartmeter/voltage_l2"
  name: "Spanning L2"
  icon: 'mdi:power-plug'
  unit_of_measurement: "V"
- platform: mqtt
  state_topic: "home/smartmeter/voltage_l3"
  name: "Spanning L3"
  icon: 'mdi:power-plug'
  unit_of_measurement: "V"

- platform: mqtt
  state_topic: "home/sonoff_oven/tele/SENSOR"
  name: "Oven Power Today"
  value_template: '{{ value_json["ENERGY"]["Today"] }}'
  icon: 'mdi:baguette'
  unit_of_measurement: "KWh"
- platform: mqtt
  state_topic: "home/sonoff_oven/tele/SENSOR"
  name: "Oven Power Now"
  value_template: '{{ value_json["ENERGY"]["Power"] }}'
  icon: 'mdi:baguette'
  unit_of_measurement: "W"

- platform: mqtt
  state_topic: "home/sonoff_pomp/tele/SENSOR"
  name: "Water pump Power Now"
  value_template: '{{ value_json["ENERGY"]["Power"] }}'
  icon: 'mdi:flash'
  unit_of_measurement: "W"
- platform: mqtt
  state_topic: "home/sonoff_pomp/tele/SENSOR"
  name: "Water pump Power Today"
  value_template: '{{ value_json["ENERGY"]["Today"] }}'
  icon: 'mdi:flash'
  unit_of_measurement: "KWh"

- platform: template
  sensors:
    alarm_clock_time:
      friendly_name: 'Alarm Time'
      icon_template: 'mdi:alarm'
      value_template: "{{ '%0.02d:%0.02d' | format( states('input_number.alarm_clock_hour') | int, states('input_number.alarm_clock_minute') | int ) }}"
    alarm_clock_fade_in_minutes:
      friendly_name: 'Fade In (Minutes)'
      icon_template: 'mdi:gradient'
      value_template: "{{ states('input_number.alarm_clock_fade_in_minutes') | int }}"
    doorbell_last_press:
      friendly_name: 'Last Doorbell Press'
      entity_id:  binary_sensor.doorbell
      icon_template: 'mdi:clock-alert'
      value_template: '{{ as_timestamp(states.binary_sensor.doorbell.last_changed) | timestamp_custom("%a %d %b %H:%M") }}'
    overloop_lux_level:
      friendly_name: 'Overloop Lux Level'
      entity_id: binary_sensor.overloop_motion_sensor
      icon_template: 'mdi:white-balance-sunny'
      unit_of_measurement: 'lx'
      value_template: '{{ states.binary_sensor.overloop_motion_sensor.attributes.lx | float }}'
    overloop_light_level:
      friendly_name: 'Overloop Light Level'
      entity_id: binary_sensor.overloop_motion_sensor
      icon_template: 'mdi:white-balance-sunny'
      unit_of_measurement: 'll'
      value_template: '{{ states.binary_sensor.overloop_motion_sensor.attributes.light_level | int }}'
    overloop_temperature:
      friendly_name: 'Overloop Sensor Temperature'
      entity_id: binary_sensor.overloop_motion_sensor
      icon_template: 'mdi:temperature-celsius'
      value_template: '{{ states.binary_sensor.overloop_motion_sensor.attributes.temperature | float }}'
      unit_of_measurement: "°C"
    bbq_meat_set_temp:
      friendly_name: 'BBQ Meat Set Temperature'
      unit_of_measurement: "°C"
      value_template: "{{ states('input_number.bbq_meat_set_temp') | int }}"
    bbq_dome_set_temp:
      friendly_name: 'BBQ Dome Set Temperature'
      unit_of_measurement: "°C"
      value_template: "{{ states('input_number.bbq_dome_set_temp') | int }}"


- platform: rflink
  automatic_add: false

- platform: buienradar
  name: !secret weather_name
  monitored_conditions:
    - stationname
    - conditioncode
    - condition
    - conditiondetailed
    - conditionexact
    - symbol
    - humidity
    - temperature
    - groundtemperature
    - windspeed
    - windforce
    - winddirection
    - windazimuth
    - pressure
    - visibility
    - windgust
    - precipitation
    - irradiance
    - precipitation_forecast_average
    - precipitation_forecast_total

- platform: afvalbeheer
  wastecollector: Waalre
  resources:
    - restafval
    - gft
    - papier
    - pbd
  postcode: 5581TL
  streetnumber: 15

- platform: mqtt
  name: Zigbee2mqtt Networkmap
  # if you change base_topic of Zigbee2mqtt, change state_topic accordingly
  state_topic: zigbee2mqtt/bridge/networkmap/raw
  value_template: >-
    {{ now().strftime('%Y-%m-%d %H:%M:%S') }}
  # again, if you change base_topic of Zigbee2mqtt, change json_attributes_topic accordingly
  json_attributes_topic: zigbee2mqtt/bridge/networkmap/raw

- platform: mqtt
  state_topic: "/speeldoos/ads1"
  name: "Speeldoos potmeter 1"
  value_template: "{{ value | int }}"
  unit_of_measurement: "%"
- platform: mqtt
  state_topic: "/speeldoos/ads2"
  name: "Speeldoos potmeter 2"
  value_template: "{{ value | int }}"
  unit_of_measurement: "%"
- platform: mqtt
  state_topic: "/speeldoos/gpio2"
  name: "Speeldoos LEDs"
  value_template: "{{ value | int }}"
- platform: mqtt
  state_topic: "/speeldoos/pushmereactiontime"
  name: "Speeldoos PushMe Reaction time"
  value_template: "{{ value | int }}"
  unit_of_measurement: 'ms'

#Zigbee2MQTT
- platform: mqtt
  name: Zigbee2mqtt Bridge state
  state_topic: "zigbee2mqtt/bridge/state"
  icon: mdi:router-wireless
# Sensor for Showing the Zigbee2mqtt Version
- platform: mqtt
  name: Zigbee2mqtt Version
  state_topic: "zigbee2mqtt/bridge/config"
  value_template: "{{ value_json.version }}"
  icon: mdi:zigbee
# Sensor for Showing the Coordinator Version
- platform: mqtt
  name: Coordinator Version
  state_topic: "zigbee2mqtt/bridge/config"
  value_template: "{{ value_json.coordinator }}"
  icon: mdi:chip

- platform: p2000
  regios: 22
  scan_interval: 30
  latitude: !secret home_latitude
  longitude: !secret home_longitude
  radius: 1000

- platform: command_line
  name: SSL cert expiry
  unit_of_measurement: days
  scan_interval: 10800
  command: "ssl-cert-check -b -c /etc/letsencrypt/live/stevenmarcha.duckdns.org/cert.pem | awk '{ print $NF }'" 

- platform: scrape
  name: Canyon Neuron Outlet
  resource: "https://www.canyon.com/en-nl/outlet/mountain-bikes/?cgid=outlet-mountain&prefn1=pc_familie&prefn2=pc_outlet&prefv1=Neuron&prefv2=true"
  select: ".js-productCount"
  unit_of_measurement: "items"

- platform: scrape
  name: Canyon MTB XL Outlet
  resource: "https://www.canyon.com/en-nl/outlet/mountain-bikes/?cgid=outlet-mountain&prefn1=pc_outlet&prefn2=pc_rahmengroesse&prefv1=true&prefv2=XL"
  select: ".js-productCount"
  unit_of_measurement: "items"

   
